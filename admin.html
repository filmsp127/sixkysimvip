<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SIXKYSIMVIP - จัดการสต็อกเบอร์</title>
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Kanit", sans-serif;
        background: #000000;
        color: #fff;
        min-height: 100vh;
      }

      /* Header */
      .header {
        background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
        border-bottom: 3px solid #ffd700;
        padding: 15px 0;
      }

      .header-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 10px;
        color: #ffd700;
        font-size: 24px;
        font-weight: 700;
      }

      .header-buttons {
        display: flex;
        gap: 10px;
      }

      .btn-header {
        padding: 10px 25px;
        border-radius: 25px;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
        font-weight: 500;
        border: none;
        font-family: "Kanit", sans-serif;
        font-size: 16px;
        cursor: pointer;
      }

      .btn-logout {
        background: #f44336;
        color: white;
      }

      .btn-home {
        background: #ffd700;
        color: #000;
      }

      .btn-header:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      /* Main Content */
      .container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 0 20px;
      }

      /* Stats Cards */
      .stats-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: #1a1a1a;
        border: 2px solid #333;
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        transition: all 0.3s;
      }

      .stat-card:hover {
        border-color: #ffd700;
        transform: translateY(-5px);
      }

      .stat-number {
        font-size: 36px;
        font-weight: 700;
        color: #ffd700;
      }

      .stat-label {
        font-size: 14px;
        color: #999;
        margin-top: 5px;
      }

      /* Add Number Form */
      .add-section {
        background: #1a1a1a;
        border: 2px solid #ffd700;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
      }

      .section-title {
        font-size: 24px;
        color: #ffd700;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
      }

      .form-group label {
        color: #ffd700;
        font-size: 14px;
      }

      .form-group input,
      .form-group select {
        padding: 10px;
        border: 2px solid #333;
        background: #000;
        color: #fff;
        border-radius: 8px;
        font-family: "Kanit", sans-serif;
        transition: all 0.3s;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: #ffd700;
      }

      .btn-container {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .btn {
        padding: 10px 30px;
        border: none;
        border-radius: 25px;
        font-family: "Kanit", sans-serif;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: #ffd700;
        color: #000;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
      }

      .btn-secondary {
        background: #333;
        color: #fff;
      }

      .btn-secondary:hover {
        background: #444;
      }

      /* Numbers Table */
      .table-section {
        background: #1a1a1a;
        border: 2px solid #333;
        border-radius: 15px;
        padding: 20px;
        overflow-x: auto;
      }

      .search-bar {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .search-input {
        flex: 1;
        padding: 10px 20px;
        border: 2px solid #333;
        background: #000;
        color: #fff;
        border-radius: 25px;
        font-family: "Kanit", sans-serif;
      }

      .search-input:focus {
        outline: none;
        border-color: #ffd700;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }

      th {
        background: #000;
        color: #ffd700;
        padding: 12px;
        text-align: left;
        font-weight: 600;
        border-bottom: 2px solid #ffd700;
      }

      td {
        padding: 12px;
        border-bottom: 1px solid #333;
        color: #ccc;
      }

      tr:hover {
        background: rgba(255, 215, 0, 0.05);
      }

      .network-badge {
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: 600;
        color: white;
        display: inline-block;
      }

      .network-badge.ais {
        background: #00a651;
      }
      .network-badge.true {
        background: #ff0000;
      }
      .network-badge.dtac {
        background: #00b4db;
      }

      .category-badge {
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 12px;
        background: #333;
        color: #ffd700;
        display: inline-block;
      }

      .new-badge {
        background: #ff1744;
        color: white;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 11px;
        font-weight: 700;
      }

      .action-buttons {
        display: flex;
        gap: 8px;
      }

      .btn-edit,
      .btn-delete {
        padding: 5px 15px;
        border: none;
        border-radius: 20px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-edit {
        background: #ffd700;
        color: #000;
      }

      .btn-delete {
        background: #f44336;
        color: white;
      }

      .btn-edit:hover,
      .btn-delete:hover {
        transform: scale(1.05);
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #666;
      }

      .empty-state i {
        font-size: 60px;
        margin-bottom: 20px;
        color: #333;
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 999;
        align-items: center;
        justify-content: center;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: #1a1a1a;
        border: 2px solid #ffd700;
        border-radius: 15px;
        padding: 30px;
        max-width: 500px;
        width: 90%;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .modal-header h3 {
        color: #ffd700;
        font-size: 24px;
      }

      .btn-close {
        background: none;
        border: none;
        color: #ffd700;
        font-size: 24px;
        cursor: pointer;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .header-content {
          flex-direction: column;
          gap: 15px;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        .stats-container {
          grid-template-columns: 1fr;
        }

        .action-buttons {
          flex-direction: column;
        }

        table {
          font-size: 14px;
        }

        th,
        td {
          padding: 8px;
        }
      }
      // Notification System
function showNotification(type, title, message, showConfetti = false) {
  const notification = document.getElementById('notification');
  const icon = notification.querySelector('.notification-icon i');
  const titleElement = notification.querySelector('.notification-title');
  const messageElement = notification.querySelector('.notification-message');
  const progress = document.getElementById('notificationProgress');
  
  // Reset classes
  notification.className = 'notification';
  
  // Set type
  notification.classList.add(type);
  
  // Set icon
  if (type === 'success') {
    icon.className = 'fas fa-check';
  } else if (type === 'error') {
    icon.className = 'fas fa-exclamation';
  } else if (type === 'warning') {
    icon.className = 'fas fa-exclamation-triangle';
  }
  
  // Set content
  titleElement.textContent = title;
  messageElement.textContent = message;
  
  // Show notification
  notification.classList.add('show');
  
  // Progress bar
  progress.style.width = '100%';
  setTimeout(() => {
    progress.style.width = '0%';
  }, 100);
  
  // Show confetti for success
  if (showConfetti && type === 'success') {
    createConfetti();
  }
  
  // Auto hide after 3 seconds
  setTimeout(() => {
    hideNotification();
  }, 3000);
}

function hideNotification() {
  const notification = document.getElementById('notification');
  notification.classList.add('hide');
  
  setTimeout(() => {
    notification.classList.remove('show', 'hide');
  }, 500);
}

// Confetti Effect
function createConfetti() {
  const container = document.getElementById('confettiContainer');
  container.innerHTML = '';
  
  for (let i = 0; i < 50; i++) {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.left = Math.random() * 100 + '%';
    confetti.style.animationDelay = Math.random() * 3 + 's';
    confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
    container.appendChild(confetti);
  }
  
  // Clear confetti after animation
  setTimeout(() => {
    container.innerHTML = '';
  }, 5000);
}
/* Notification Popup */
.notification {
  position: fixed;
  top: -100px;
  right: 20px;
  background: #1a1a1a;
  border: 2px solid #ffd700;
  border-radius: 15px;
  padding: 20px 30px;
  display: flex;
  align-items: center;
  gap: 15px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
  transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  z-index: 10000;
  min-width: 300px;
}

.notification.show {
  top: 20px;
  animation: slideInBounce 0.5s ease-out;
}

@keyframes slideInBounce {
  0% {
    transform: translateY(-100%) scale(0.8);
    opacity: 0;
  }
  50% {
    transform: translateY(10px) scale(1.05);
  }
  100% {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
}

.notification.hide {
  top: -100px;
  opacity: 0;
  transform: translateY(-20px);
}

.notification-icon {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  flex-shrink: 0;
}

.notification.success .notification-icon {
  background: linear-gradient(135deg, #4caf50, #8bc34a);
  color: white;
  box-shadow: 0 4px 20px rgba(76, 175, 80, 0.4);
}

.notification.error .notification-icon {
  background: linear-gradient(135deg, #f44336, #ff5722);
  color: white;
  box-shadow: 0 4px 20px rgba(244, 67, 54, 0.4);
}

.notification.warning .notification-icon {
  background: linear-gradient(135deg, #ff9800, #ffc107);
  color: white;
  box-shadow: 0 4px 20px rgba(255, 152, 0, 0.4);
}

.notification-content {
  flex: 1;
}

.notification-title {
  color: #ffd700;
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 5px;
}

.notification-message {
  color: #ccc;
  font-size: 14px;
}

.notification-close {
  background: none;
  border: none;
  color: #666;
  font-size: 20px;
  cursor: pointer;
  padding: 5px;
  transition: all 0.3s;
}

.notification-close:hover {
  color: #ffd700;
  transform: rotate(90deg);
}

.notification-progress {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 3px;
  background: #ffd700;
  border-radius: 0 0 13px 13px;
  transition: width 3s linear;
}

@keyframes confetti {
  0% {
    transform: translateY(0) rotate(0deg);
    opacity: 1;
  }
  100% {
    transform: translateY(100px) rotate(720deg);
    opacity: 0;
  }
}

.confetti-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
  z-index: 9999;
}

.confetti {
  position: absolute;
  width: 10px;
  height: 10px;
  background: #ffd700;
  animation: confetti 3s ease-out forwards;
}

.confetti:nth-child(even) {
  background: #ff6b6b;
  width: 8px;
  height: 8px;
}

.confetti:nth-child(3n) {
  background: #4ecdc4;
  width: 12px;
  height: 12px;
}
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <i class="fas fa-cog"></i>
          <span>จัดการสต็อกเบอร์</span>
        </div>
        <div class="header-buttons">
          <button onclick="logout()" class="btn-header btn-logout">
            <i class="fas fa-sign-out-alt"></i> ออกจากระบบ
          </button>
          <a href="index.html" class="btn-header btn-home">
            <i class="fas fa-home"></i> กลับหน้าหลัก
          </a>
        </div>
      </div>
    </header>

    <!-- Main Container -->
    <div class="container">
      <!-- Stats Cards -->
      <div class="stats-container">
        <div class="stat-card">
          <div class="stat-number" id="totalNumbers">0</div>
          <div class="stat-label">เบอร์ทั้งหมด</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="mongkolCount">0</div>
          <div class="stat-label">เบอร์มงคล</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="beautifulCount">0</div>
          <div class="stat-label">เบอร์สวย</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="tongCount">0</div>
          <div class="stat-label">เบอร์ตอง</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="fourCount">0</div>
          <div class="stat-label">เบอร์โฟร์</div>
        </div>
      </div>

      <!-- Add Number Form -->
      <div class="add-section">
        <h2 class="section-title">
          <i class="fas fa-plus-circle"></i> เพิ่มเบอร์ใหม่
        </h2>
        <form id="addNumberForm">
          <div class="form-grid">
            <div class="form-group">
              <label>เบอร์โทรศัพท์</label>
              <input
                type="text"
                id="phoneNumber"
                placeholder="089999999"
                maxlength="12"
                required
              />
            </div>
            <div class="form-group">
              <label>เครือข่าย</label>
              <select id="network" required>
                <option value="">เลือกเครือข่าย</option>
                <option value="AIS">AIS</option>
                <option value="TRUE">TRUE</option>
                <option value="DTAC">DTAC</option>
              </select>
            </div>
            <div class="form-group">
              <label>หมวดหมู่</label>
              <select id="category" required>
                <option value="">เลือกหมวดหมู่</option>
                <option value="mongkol">เบอร์มงคล</option>
                <option value="beautiful">เบอร์สวย</option>
                <option value="tong">เบอร์ตอง</option>
                <option value="four">เบอร์โฟร์</option>
              </select>
            </div>
            <div class="form-group">
              <label>ราคา (บาท)</label>
              <input type="number" id="price" placeholder="1000000" required />
            </div>
          </div>
          <div class="btn-container">
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-plus"></i> เพิ่มเบอร์
            </button>
            <button
              type="button"
              class="btn btn-secondary"
              onclick="clearForm()"
            >
              <i class="fas fa-times"></i> ล้างฟอร์ม
            </button>
          </div>
        </form>
      </div>

      <!-- Numbers Table -->
      <div class="table-section">
        <h2 class="section-title">
          <i class="fas fa-list"></i> รายการเบอร์ทั้งหมด
        </h2>
        <div class="search-bar">
          <input
            type="text"
            class="search-input"
            id="searchInput"
            placeholder="ค้นหาเบอร์..."
          />
          <button class="btn btn-primary" onclick="searchNumbers()">
            <i class="fas fa-search"></i> ค้นหา
          </button>
        </div>
        <div id="numbersTable">
          <!-- Table will be rendered here -->
        </div>
      </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal" id="editModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>แก้ไขเบอร์</h3>
          <button class="btn-close" onclick="closeModal()">&times;</button>
        </div>
        <form id="editForm">
          <input type="hidden" id="editId" />
          <div class="form-grid">
            <div class="form-group">
              <label>เบอร์โทรศัพท์</label>
              <input type="text" id="editPhoneNumber" maxlength="12" required />
            </div>
            <div class="form-group">
              <label>เครือข่าย</label>
              <select id="editNetwork" required>
                <option value="AIS">AIS</option>
                <option value="TRUE">TRUE</option>
                <option value="DTAC">DTAC</option>
              </select>
            </div>
            <div class="form-group">
              <label>หมวดหมู่</label>
              <select id="editCategory" required>
                <option value="mongkol">เบอร์มงคล</option>
                <option value="beautiful">เบอร์สวย</option>
                <option value="tong">เบอร์ตอง</option>
                <option value="four">เบอร์โฟร์</option>
              </select>
            </div>
            <div class="form-group">
              <label>ราคา (บาท)</label>
              <input type="number" id="editPrice" required />
            </div>
          </div>
          <div class="btn-container" style="margin-top: 20px">
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i> บันทึก
            </button>
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeModal()"
            >
              <i class="fas fa-times"></i> ยกเลิก
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script>
      // Firebase Configuration
      const firebaseConfig = {
        apiKey: "AIzaSyCkPjpI64uVWvx26MJfQcm-eWda8RsThQg",
        authDomain: "sixkysimvip-24c69.firebaseapp.com",
        projectId: "sixkysimvip-24c69",
        storageBucket: "sixkysimvip-24c69.firebasestorage.app",
        messagingSenderId: "459018922628",
        appId: "1:459018922628:web:5dbec1f2dc0c90956030d1"
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      // Phone numbers collection reference
      const phoneNumbersRef = db.collection('phoneNumbers');

      // ฟังก์ชันสำหรับดึงข้อมูลจาก Firebase
      async function getPhoneNumbersFromFirebase() {
        try {
          const snapshot = await phoneNumbersRef.get();
          const numbers = [];
          snapshot.forEach(doc => {
            numbers.push({ id: doc.id, ...doc.data() });
          });
          return numbers;
        } catch (error) {
          console.error("Error getting phone numbers:", error);
          return [];
        }
      }

      // ฟังก์ชันสำหรับเพิ่มเบอร์ใหม่
      async function addPhoneNumberToFirebase(phoneData) {
        try {
          const docRef = await phoneNumbersRef.add({
            ...phoneData,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
          return docRef.id;
        } catch (error) {
          console.error("Error adding phone number:", error);
          throw error;
        }
      }

      // ฟังก์ชันสำหรับอัพเดทเบอร์
      async function updatePhoneNumberInFirebase(id, phoneData) {
        try {
          await phoneNumbersRef.doc(id).update({
            ...phoneData,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
          });
        } catch (error) {
          console.error("Error updating phone number:", error);
          throw error;
        }
      }

      // ฟังก์ชันสำหรับลบเบอร์
      async function deletePhoneNumberFromFirebase(id) {
        try {
          await phoneNumbersRef.doc(id).delete();
        } catch (error) {
          console.error("Error deleting phone number:", error);
          throw error;
        }
      }
    </script>

    <!-- Main JavaScript -->
    <script>
      // Check admin access on page load
      function checkAdminAccess() {
        const isAdmin = sessionStorage.getItem("isAdmin");
        if (!isAdmin || isAdmin !== "true") {
          // ไม่ต้องแจ้งเตือน เพราะจะ redirect ทันที
// alert("คุณไม่มีสิทธิ์เข้าถึงหน้านี้!");
          window.location.href = "index.html";
          return false;
        }
        return true;
      }
// Notification System
function showNotification(type, title, message, showConfetti = false) {
        const notification = document.getElementById('notification');
        const icon = notification.querySelector('.notification-icon i');
        const titleElement = notification.querySelector('.notification-title');
        const messageElement = notification.querySelector('.notification-message');
        const progress = document.getElementById('notificationProgress');
        
        // Reset classes
        notification.className = 'notification';
        
        // Set type
        notification.classList.add(type);
        
        // Set icon
        if (type === 'success') {
          icon.className = 'fas fa-check';
        } else if (type === 'error') {
          icon.className = 'fas fa-exclamation';
        } else if (type === 'warning') {
          icon.className = 'fas fa-exclamation-triangle';
        }
        
        // Set content
        titleElement.textContent = title;
        messageElement.textContent = message;
        
        // Show notification
        notification.classList.add('show');
        
        // Progress bar
        progress.style.width = '100%';
        setTimeout(() => {
          progress.style.width = '0%';
        }, 100);
        
        // Show confetti for success
        if (showConfetti && type === 'success') {
          createConfetti();
        }
        
        // Auto hide after 3 seconds
        setTimeout(() => {
          hideNotification();
        }, 3000);
      }

      function hideNotification() {
        const notification = document.getElementById('notification');
        notification.classList.add('hide');
        
        setTimeout(() => {
          notification.classList.remove('show', 'hide');
        }, 500);
      }

      // Confetti Effect
      function createConfetti() {
        const container = document.getElementById('confettiContainer');
        container.innerHTML = '';
        
        for (let i = 0; i < 50; i++) {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.left = Math.random() * 100 + '%';
          confetti.style.animationDelay = Math.random() * 3 + 's';
          confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
          container.appendChild(confetti);
        }
        
        // Clear confetti after animation
        setTimeout(() => {
          container.innerHTML = '';
        }, 5000);
      }
      // Logout function
      function logout() {
        sessionStorage.removeItem("isAdmin");
        window.location.href = "index.html";
      }

      // Phone numbers data
      let phoneNumbers = [];

      // Initialize data from Firebase
      async function initializeData() {
        try {
          phoneNumbers = await getPhoneNumbersFromFirebase();
          updateStats();
          renderTable();
        } catch (error) {
          console.error("Error initializing data:", error);
        }
      }

      // Get phone numbers
      function getPhoneNumbers() {
        return phoneNumbers;
      }

      // Format phone number automatically
      function formatPhoneNumber(input) {
        // เก็บตำแหน่ง cursor
        let cursorPosition = input.selectionStart;

        // เอาเฉพาะตัวเลข
        let numbers = input.value.replace(/[^0-9]/g, "");

        // จำกัดไว้ที่ 10 ตัว
        if (numbers.length > 10) {
          numbers = numbers.substring(0, 10);
        }

        // ใส่ขีดกลาง
        let formatted = "";
        if (numbers.length <= 3) {
          formatted = numbers;
        } else if (numbers.length <= 6) {
          formatted = numbers.substring(0, 3) + "-" + numbers.substring(3);
        } else {
          formatted =
            numbers.substring(0, 3) +
            "-" +
            numbers.substring(3, 6) +
            "-" +
            numbers.substring(6);
        }

        // ใส่ค่ากลับ
        input.value = formatted;
      }

      // Update statistics
      function updateStats() {
        const numbers = getPhoneNumbers();
        document.getElementById("totalNumbers").textContent = numbers.length;
        document.getElementById("mongkolCount").textContent = numbers.filter(
          (n) => n.category === "mongkol"
        ).length;
        document.getElementById("beautifulCount").textContent = numbers.filter(
          (n) => n.category === "beautiful"
        ).length;
        document.getElementById("tongCount").textContent = numbers.filter(
          (n) => n.category === "tong"
        ).length;
        document.getElementById("fourCount").textContent = numbers.filter(
          (n) => n.category === "four"
        ).length;
      }

      // Render numbers table
      function renderTable(numbersToShow = null) {
        const numbers = numbersToShow || getPhoneNumbers();
        const tableContainer = document.getElementById("numbersTable");

        if (numbers.length === 0) {
          tableContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>ยังไม่มีเบอร์ในระบบ</p>
                    </div>
                `;
          return;
        }

        const categoryNames = {
          mongkol: "เบอร์มงคล",
          beautiful: "เบอร์สวย",
          tong: "เบอร์ตอง",
          four: "เบอร์โฟร์",
        };

        let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>เบอร์</th>
                            <th>เครือข่าย</th>
                            <th>หมวดหมู่</th>
                            <th>ราคา</th>
                            <th>สถานะ</th>
                            <th>จัดการ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

        numbers.forEach((phone) => {
          tableHTML += `
                    <tr>
                        <td style="font-weight: 600;">${phone.number}</td>
                        <td><span class="network-badge ${phone.network.toLowerCase()}">${
            phone.network
          }</span></td>
                        <td><span class="category-badge">${
                          categoryNames[phone.category]
                        }</span></td>
                        <td style="color: #ffd700;">฿${phone.price.toLocaleString()}</td>
                        <td><span class="new-badge">NEW</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-edit" onclick="editNumber('${
                                  phone.id
                                }')">
                                    <i class="fas fa-edit"></i> แก้ไข
                                </button>
                                <button class="btn-delete" onclick="deleteNumber('${
                                  phone.id
                                }')">
                                    <i class="fas fa-trash"></i> ลบ
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
        });

        tableHTML += `
                    </tbody>
                </table>
            `;

        tableContainer.innerHTML = tableHTML;
      }

      // Add new number
      document.getElementById("addNumberForm").addEventListener("submit", async function (e) {
        e.preventDefault();

        const newNumber = {
          number: document.getElementById("phoneNumber").value,
          network: document.getElementById("network").value,
          category: document.getElementById("category").value,
          price: parseInt(document.getElementById("price").value),
          isNew: true,
        };

        try {
          const docId = await addPhoneNumberToFirebase(newNumber);
          newNumber.id = docId;
          phoneNumbers.push(newNumber);
          
          clearForm();
          renderTable();
          updateStats();
          showNotification('success', 'เพิ่มเบอร์สำเร็จ!', `เพิ่ม ${newNumber.number} เรียบร้อยแล้ว`, true);
        } catch (error) {
          showNotification('error', 'เกิดข้อผิดพลาด!', error.message);
        }
      });

      // Clear form
      function clearForm() {
        document.getElementById("addNumberForm").reset();
      }

      // Edit number
      function editNumber(id) {
        const numbers = getPhoneNumbers();
        const phone = numbers.find((n) => n.id === id);

        if (phone) {
          document.getElementById("editId").value = phone.id;
          document.getElementById("editPhoneNumber").value = phone.number;
          document.getElementById("editNetwork").value = phone.network;
          document.getElementById("editCategory").value = phone.category;
          document.getElementById("editPrice").value = phone.price;

          document.getElementById("editModal").classList.add("active");
        }
      }

      // Close modal
      function closeModal() {
        document.getElementById("editModal").classList.remove("active");
      }

      // Save edited number
      document.getElementById("editForm").addEventListener("submit", async function (e) {
        e.preventDefault();

        const id = document.getElementById("editId").value;
        const index = phoneNumbers.findIndex((n) => n.id === id);

        if (index !== -1) {
          const updatedData = {
            number: document.getElementById("editPhoneNumber").value,
            network: document.getElementById("editNetwork").value,
            category: document.getElementById("editCategory").value,
            price: parseInt(document.getElementById("editPrice").value),
          };

          try {
            await updatePhoneNumberInFirebase(id, updatedData);
            phoneNumbers[index] = {
              ...phoneNumbers[index],
              ...updatedData
            };
            
            closeModal();
            renderTable();
            updateStats();
            showNotification('success', 'แก้ไขเบอร์สำเร็จ!', 'ข้อมูลได้รับการอัพเดทแล้ว');
          } catch (error) {
            showNotification('error', 'เกิดข้อผิดพลาด!', error.message);
          }
        }
      });

      // Delete number
      async function deleteNumber(id) {
        if (confirm("คุณแน่ใจหรือไม่ที่จะลบเบอร์นี้?")) {
          try {
            await deletePhoneNumberFromFirebase(id);
            phoneNumbers = phoneNumbers.filter((n) => n.id !== id);
            renderTable();
            updateStats();
            showNotification('warning', 'ลบเบอร์สำเร็จ!', 'เบอร์ถูกลบออกจากระบบแล้ว');
          } catch (error) {
            showNotification('error', 'เกิดข้อผิดพลาด!', error.message);
          }
        }
      }

      // Search numbers
      function searchNumbers() {
        const searchTerm = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const numbers = getPhoneNumbers();

        const filtered = numbers.filter(
          (phone) =>
            phone.number.toLowerCase().includes(searchTerm) ||
            phone.network.toLowerCase().includes(searchTerm) ||
            phone.category.toLowerCase().includes(searchTerm)
        );

        renderTable(filtered);
      }

      // Setup phone formatting
      function setupPhoneFormatting() {
        // For add form
        const phoneInput = document.getElementById("phoneNumber");
        phoneInput.addEventListener("input", function () {
          formatPhoneNumber(this);
        });

        // For edit form
        const editPhoneInput = document.getElementById("editPhoneNumber");
        editPhoneInput.addEventListener("input", function () {
          formatPhoneNumber(this);
        });
      }

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        // Check admin access first
        if (!checkAdminAccess()) {
          return;
        }

        // Initialize data
        initializeData();

        // Setup phone formatting
        setupPhoneFormatting();

        // Add enter key support for search
        document
          .getElementById("searchInput")
          .addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              searchNumbers();
            }
          });

        // Real-time search
        document
          .getElementById("searchInput")
          .addEventListener("input", function (e) {
            const searchTerm = e.target.value.toLowerCase();
            const numbers = getPhoneNumbers();

            if (searchTerm === "") {
              renderTable();
            } else {
              const filtered = numbers.filter(
                (phone) =>
                  phone.number.toLowerCase().includes(searchTerm) ||
                  phone.network.toLowerCase().includes(searchTerm) ||
                  phone.category.toLowerCase().includes(searchTerm)
              );
              renderTable(filtered);
            }
          });
      });
    </script>
    <!-- Notification Container -->
    <div id="notification" class="notification">
      <div class="notification-icon">
        <i class="fas fa-check"></i>
      </div>
      <div class="notification-content">
        <div class="notification-title">สำเร็จ!</div>
        <div class="notification-message">ดำเนินการเรียบร้อยแล้ว</div>
      </div>
      <button class="notification-close" onclick="hideNotification()">
        <i class="fas fa-times"></i>
      </button>
      <div class="notification-progress" id="notificationProgress"></div>
    </div>

    <!-- Confetti Container -->
    <div id="confettiContainer" class="confetti-container"></div>
  </body>
</html>
